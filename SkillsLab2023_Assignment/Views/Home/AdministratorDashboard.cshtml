@model List<DAL.DTO.TrainingDTO>

@{
    ViewBag.Title = "Dashboard";
}

<link href="~/Content/app/Admin.css" rel="stylesheet" />
<link href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css" rel="stylesheet" />
<script defer src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
<script defer src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
<script defer src="~/Scripts/app/Admin.js"></script>

<h2>View all trainings</h2>

@if (Model == null || Model.Count == 0)
{
    Response.Redirect("~/Common/InternalServerError");
}
else
{
    <div class="table-wrapper">
        <table id="allTrainings" class="table table-striped table-hover" style="width: 100%;">
            <thead>
                <tr>
                    <th>Status</th>
                    <th>TrainingName</th>
                    <th>DeadlineOfApplication</th>
                    <th>Capacity</th>
                    <th>DepartmentName</th>
                    <th>Pre-Requisite</th>
                    <th>Edit</th>
                    <th>Delete</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                @foreach (var training in Model)
                {
                    <tr>
                        <td>
                            @if (training.IsDeadlineExpired)
                            {
                                <span class="badge rounded-pill text-bg-danger">Closed</span>
                            }
                            else
                            {
                                <span class="badge rounded-pill text-bg-success">Open</span>
                            }
                        </td>
                        <td>@training.TrainingName</td>
                        <td>@training.DeadlineOfApplication</td>
                        <td>@training.Capacity</td>
                        <td>@training.DepartmentName</td>
                        <td class="pre-requisite-cell">
                            @if (training.PreRequisites != null && training.PreRequisites.Any())
                            {
                                <ul class="ps-3">
                                    @foreach (var preRequisite in training.PreRequisites)
                                    {
                                        <li>@preRequisite.PreRequisiteName</li>
                                    }
                                </ul>
                            }
                            else
                            {
                                <div class="text-danger">
                                    <span>No Pre Requisites for this training</span>
                                </div>
                            }
                        </td>
                        <td>
                            <button data-training-id="@training.TrainingId" type="button" class="btn btn-labeled btn-outline-primary edit-btn">
                                <span class="btn-label"><i class="fa-regular fa-pen-to-square"></i></span>
                            </button>
                        </td>
                        <td>
                            <button data-training-id="@training.TrainingId" type="button" class="btn btn-labeled btn-outline-danger delete-btn text-center">
                                <span class="btn-label"><i class="fa-solid fa-trash trashIcon"></i></span>
                                <div class="spinner-border spinner-border-sm spinner" role="status" style="display: none;">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                            </button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}