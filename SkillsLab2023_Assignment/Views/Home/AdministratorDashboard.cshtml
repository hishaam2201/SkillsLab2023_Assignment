@model List<DAL.DTO.TrainingDTO>

@{
    ViewBag.Title = "Dashboard";
}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/slim-select/2.8.0/slimselect.css"
      integrity="sha512-0jtuSOf2mf7BDdp4NdezEWR/IZ3UuXNxfeJ/AmdP6cyRbkBxGmVjKv91i/cxWksjJtnpSSOsuhxFN0t7xiPA0Q=="
      crossorigin="anonymous" referrerpolicy="no-referrer" />
<link href="~/Content/app/Admin.css" rel="stylesheet" />
<link href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css" rel="stylesheet" />
<script defer src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
<script defer src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/slim-select/2.8.0/slimselect.min.js"
        integrity="sha512-mG8eLOuzKowvifd2czChe3LabGrcIU8naD1b9FUVe4+gzvtyzSy+5AafrHR57rHB+msrHlWsFaEYtumxkC90rg=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script defer src="~/Scripts/app/Admin.js"></script>

<h2>View all trainings</h2>

@if (Model == null || Model.Count == 0)
{
    Response.Redirect("~/Common/InternalServerError");
}
else
{
    <div class="table-wrapper">
        <table id="allTrainings" class="table table-striped table-hover" style="width: 100%;">
            <thead>
                <tr>
                    <th>Status</th>
                    <th>TrainingName</th>
                    <th>DeadlineOfApplication</th>
                    <th>Capacity</th>
                    <th>DepartmentName</th>
                    <th>Pre-Requisite</th>
                    <th>Edit</th>
                    <th>Delete</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                @foreach (var training in Model)
                {
                    <tr>
                        <td>
                            @if (training.IsDeadlineExpired)
                            {
                                <span class="badge rounded-pill text-bg-danger">Closed</span>
                            }
                            else
                            {
                                <span class="badge rounded-pill text-bg-success">Open</span>
                            }
                        </td>
                        <td>@training.TrainingName</td>
                        <td>@training.DeadlineOfApplication.ToString("d MMMM, yyyy")</td>
                        <td>@training.Capacity</td>
                        <td>@training.DepartmentName</td>
                        <td class="pre-requisite-cell">
                            @if (training.PreRequisites != null && training.PreRequisites.Any())
                            {
                                <ul class="ps-3">
                                    @foreach (var preRequisite in training.PreRequisites)
                                    {
                                        <li>@preRequisite.PreRequisiteName</li>
                                    }
                                </ul>
                            }
                            else
                            {
                                <div class="text-danger">
                                    <span>No Pre Requisites for this training</span>
                                </div>
                            }
                        </td>
                        <td>
                            <button data-training-id="@training.TrainingId" type="button"
                                    class="btn btn-labeled btn-outline-primary edit-btn"
                                    data-bs-target="#updateTrainingModal">
                                <span class="btn-label"><i class="fa-regular fa-pen-to-square icon"></i></span>
                                <div class="spinner-border spinner-border-sm spinner" role="status" style="display: none;">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                            </button>
                        </td>
                        <td>
                            <button data-training-id="@training.TrainingId" type="button" class="btn btn-labeled btn-outline-danger delete-btn text-center">
                                <span class="btn-label"><i class="fa-solid fa-trash icon"></i></span>
                                <div class="spinner-border spinner-border-sm spinner" role="status" style="display: none;">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                            </button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <!-- Edit Training Modal -->
    <div class="modal fade" id="updateTrainingModal" tabindex="-1" aria-labelledby="updateTrainingModalLabel" aria-hidden="true" data-bs-focus="false">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5 text-center" id="updateTrainingModalLabel">Editing <span id="trainingTitle"></span></h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="editTrainingForm" method="post" onsubmit="return false;" novalidate>
                    <div class="modal-body p-4">
                        <div class="row">
                            <div class="row mb-3">
                                <div class="col-12">
                                    <label for="trainingName" class="form-label">Training Name</label>
                                    <input type="text" class="form-control" id="trainingName" required>
                                    <div class="invalid-feedback">Training name is required</div>
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-12">
                                    <label for="trainingDescription" class="form-label">Description</label>
                                    <textarea class="form-control" aria-label="Description" id="trainingDescription" maxlength="600" rows="3" required></textarea>
                                    <div class="invalid-feedback">Training description is required</div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="applicationDeadline" class="form-label">Application Deadline</label>
                                    <input type="date" class="form-control" id="applicationDeadline" required />
                                    <div class="invalid-feedback">Application deadline is required</div>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="capacity" class="form-label">Capacity</label>
                                    <input type="number" class="form-control" id="capacity" min="5" required />
                                    <div class="invalid-feedback">Capacity is required</div>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="departments" class="form-label">Department</label>
                                    <select id="departments" class="form-select" aria-label="departments" required>
                                    </select>
                                    <div class="invalid-feedback">A department is required</div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="trainingStartDate" class="form-label">Training Start Date</label>
                                    <input type="date" class="form-control" id="trainingStartDate" required />
                                    <div class="invalid-feedback">Training start date is required</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="trainingStartTime" class="form-label">Training Start Time</label>
                                    <input type="time" class="form-control" id="trainingStartTime" step="1" required />
                                    <div class="invalid-feedback">Training start time is required</div>
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-12">
                                    <label for="allPreRequisites" class="form-label">Training Pre-Requisites</label>
                                    <select id="allPreRequisites" class="p-2" multiple>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary" @*data-bs-dismiss="modal"*@>
                        <i class="fa-solid fa-floppy-disk"></i>&nbsp;&nbsp;Save changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
}